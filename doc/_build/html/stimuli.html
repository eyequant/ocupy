<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Organization of stimuli: categories, images and features &mdash; res.analysis 0.01 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="res.analysis 0.01 documentation" href="index.html" />
    <link rel="next" title="Loader" href="loader.html" />
    <link rel="prev" title="FixMat" href="fixmat.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="loader.html" title="Loader"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="fixmat.html" title="FixMat"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">res.analysis 0.01 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="organization-of-stimuli-categories-images-and-features">
<h1>Organization of stimuli: categories, images and features<a class="headerlink" href="#organization-of-stimuli-categories-images-and-features" title="Permalink to this headline">¶</a></h1>
<p>This module aims at providing easy access to images and feature maps.
It respects that images are organized in different categories.</p>
<p>Using this module has several advantages over simply loading images or
feature maps at runtime:</p>
<blockquote>
<div><ol class="arabic simple">
<li><strong>Alignment</strong>: You can iterate over images and access all fixations made on this image. The access is handled transparently for you.</li>
<li><strong>Abstraction</strong>: If treated right, it doesn&#8217;t matter where or how your data is organized. Stored in the web? Strange naming conventions? No problem, but you will have to adapt some minor things in the backend. The interface however stays.</li>
</ol>
</div></blockquote>
<p>The graph below describes the dependency structure of classes within the stimulus module. The general idea is that images are organized in categories (one category maps to many images) and that images provide access to the raw image data and to features of the image (again a 1:n mapping). Data is loaded via a proxy class which abstracts from the actual access (this is a n:1 mapping).</p>
<p class="graphviz">
digraph Stimuli {
        node [shape = record,height=.1];
        node0[label = &quot;&lt;f0&gt; Category 1 | &lt;f1&gt; Category 2&quot;];
        node1[label = &quot;&lt;f0&gt; Image 1 | ... | &lt;f1&gt; Image n&quot;];
        node2[label = &quot;&lt;f0&gt; Image 1 | ... | &lt;f1&gt; Image n&quot;];
        node3[label = &quot;&lt;f0&gt; Image Data | &lt;f1&gt; Feature 1 | ... | &lt;f2&gt; Feature n&quot;];
        node4[label = &quot;&lt;f0&gt; Image Data | &lt;f1&gt; Feature 1 | ... | &lt;f2&gt; Feature n&quot;];
        &quot;node0&quot;:f0 -&gt; &quot;node1&quot;:f0;
        &quot;node0&quot;:f1 -&gt; &quot;node2&quot;:f0;
        &quot;node1&quot;:f0 -&gt; &quot;node3&quot;:f0;
        &quot;node2&quot;:f0 -&gt; &quot;node4&quot;:f0;
        &quot;node4&quot;:f0 -&gt; Loader;
        &quot;node4&quot;:f1 -&gt; Loader;
        &quot;node4&quot;:f2 -&gt; Loader;
        &quot;node3&quot;:f0 -&gt; Loader;
        &quot;node3&quot;:f1 -&gt; Loader;
        &quot;node3&quot;:f2 -&gt; Loader;
}</p>
<p>The remainder of this document describes the interface of the stimuli
module and how it interacts with the loader module.</p>
<div class="section" id="loading-data-from-somewhere">
<h2>Loading Data from somewhere<a class="headerlink" href="#loading-data-from-somewhere" title="Permalink to this headline">¶</a></h2>
<p>To access images and feature maps, we need to be able to load them into
memory. This task is carried out by the <em>loader</em>. It encapsulates the
direct data access, such that we do not have to worry about it later.</p>
<p>Let&#8217;s look at an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">LoadFromDisk</span><span class="p">(</span><span class="s">&#39;my-images&#39;</span><span class="p">,</span> <span class="s">&#39;my-features&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">768</span><span class="p">,</span><span class="mi">1024</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
<span class="go">-&gt; Returns image 17 in category 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="s">&#39;BYCHigh&#39;</span><span class="p">)</span>
<span class="go">-&gt; Returns feature BYCHigh for image 17 in category 2</span>
</pre></div>
</div>
<p>In this case we use a loader that reads features and images from the hard disk.
In the constructor, we specify where the images and features are located. A
neat functionality is that the &#8216;LoadFromDisk&#8217; loader can automatically resize images and
features to the same size (given by the size argument). By default
&#8216;LoadFromDisk&#8217;
respects the following file layout: my-images/cat/cat_image.png
and my-features/cat/feature/cat_image.mat
If you use a different naming scheme it is easy to rip the standard out and plug
in your naming scheme. All you have to do is to replace LoadFromDisk&#8217;s &#8216;path&#8217; function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">LoadFromDisk</span><span class="p">(</span><span class="s">&#39;my-images&#39;</span><span class="p">,</span> <span class="s">&#39;my-features&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">768</span><span class="p">,</span><span class="mi">1024</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="go">        if len(args) == 1:</span>
<span class="go">            return self.impath</span>
<span class="go">        elif len(args) == 2:</span>
<span class="go">            return os.path.join(self.impath, &#39;%i_%i.png&#39;%(args[0],args[1]))</span>
<span class="go">        elif len(args) == 3:</span>
<span class="go">            return os.path.join(self.impath, &#39;%i_%i_%f.mat&#39;%(args[0],args[1],args[2]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">my_path</span>
</pre></div>
</div>
<p>And now the loader will respect a my-images/cat_image.png and
my-images/cat_image_feature.mat naming scheme. You can of course also inherit
from LoadFromDisk and overwrite the path method if you want to use this naming
scheme more often.</p>
<p>To use a completely different loader (say, one that pulls stimuli from a
SQL database) you have to implement your own. To achieve this, inherit
from loader.Loader and fill all methods specified there with life.</p>
</div>
<div class="section" id="working-with-the-stimulus-module">
<h2>Working with the stimulus module<a class="headerlink" href="#working-with-the-stimulus-module" title="Permalink to this headline">¶</a></h2>
<p>To abstract the data access is a first step but does not provide much in terms of
convenience. The stimuli module defines three classes that organize stimuli into
categories, images and features:</p>
<blockquote>
<div><ul class="simple">
<li>The <strong>Categories</strong> class encapsulates different categories that are available</li>
<li>The <strong>Images</strong> class represents all images within a category</li>
<li>The <strong>Image</strong> class provides direct access to the image data and feature maps of the image</li>
</ul>
</div></blockquote>
<p>I think the interface is pretty much self-explaining:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">LoadFromDisk</span><span class="p">(</span><span class="s">&#39;path-to-my-images&#39;</span><span class="p">,</span> <span class="s">&#39;path-to-my-features&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">768</span><span class="p">,</span><span class="mi">1024</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inp</span> <span class="o">=</span> <span class="n">stimuli</span><span class="o">.</span><span class="n">Categories</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">img_per_cat</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">26</span><span class="p">),</span><span class="mi">9</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="c"># yields image 17 in category 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">17</span><span class="p">][</span><span class="s">&#39;BYCHigh&#39;</span><span class="p">]</span> <span class="c"># yields feature BYCHigh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">:</span>
<span class="go">        for img in cat:</span>
<span class="go">            img.data # Gives the image</span>
<span class="go">            img[&#39;BYCHigh&#39;] # Gives feature BYCHigh</span>
</pre></div>
</div>
<p>In this case, I specified all possible category / image combinations.
Often we want to access images and features that have been arranged by
some structure beforehand. The most obvious case is that we have a fixmat that already specifies all possible category, and image combinations. To create a stimuli object that is aligned to a fixmat we can use the <strong>FixmatStimuliFactory</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">fixmat</span><span class="o">.</span><span class="n">DirectoryFixmatFactory</span><span class="p">(</span><span class="s">&#39;path-to-fixmats&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">LoadFromDisk</span><span class="p">(</span><span class="n">impath</span> <span class="o">=</span> <span class="s">&#39;path-to-imgs&#39;</span><span class="p">,</span> <span class="n">ftrpath</span> <span class="o">=</span> <span class="s">&#39;path-to-ftrs&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stim</span> <span class="o">=</span> <span class="n">stimuli</span><span class="o">.</span><span class="n">FixmatStimuliFactory</span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively we can use the <strong>DirectoryStimuliFactory</strong> to automatically index all categories and files in a directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stim</span> <span class="o">=</span> <span class="n">stimuli</span><span class="o">.</span><span class="n">DirectoryStimuliFactory</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stim</span><span class="o">.</span><span class="n">categories</span><span class="p">()</span>
<span class="go">[2,9]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">images</span><span class="p">()</span>
<span class="go">[16, 17, ..., 25]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stim</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">images</span><span class="p">()</span>
<span class="go">[1, 2, ..., 50]</span>
</pre></div>
</div>
<p>This, however, works only for the default file layout structure (cat/cat_img.png, cat/ftr/cat_img.mat).</p>
</div>
<div class="section" id="combining-fixation-data-and-stimulus-data">
<h2>Combining fixation data and stimulus data<a class="headerlink" href="#combining-fixation-data-and-stimulus-data" title="Permalink to this headline">¶</a></h2>
<p>In many cases, we want to iterate over images and fixation data at the same
time. The stimuli module automatically aligns fixation and image data.</p>
<p>To use this functionality the data proxy (i.e. categories, images or features)
must be created with a FixMat:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">fixmat</span><span class="o">.</span><span class="n">DirectoryFixmatFactory</span><span class="p">(</span><span class="s">&#39;my-fixmats&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inp</span> <span class="o">=</span> <span class="n">stimuli</span><span class="o">.</span><span class="n">Categories</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">fm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">fixations</span>
<span class="go">-&gt; FixMat that contains only fixations on image 17 fron category 2</span>
</pre></div>
</div>
<p>If the data proxy is initialized with a set of possible category / image
combinations we can also iterate over it. In this case it is probably
handy to use the FixmatStimuliFactory which extracts all possible
category / image combinations from a fixmat:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">inp</span> <span class="o">=</span> <span class="n">stimuli</span><span class="o">.</span><span class="n">FixmatStimuliFactory</span><span class="p">(</span><span class="n">fm</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">:</span>
<span class="go">        for img in cat:</span>
<span class="go">            img.fixations</span>
</pre></div>
</div>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ocupy.stimuli.FixmatStimuliFactory">
<tt class="descclassname">ocupy.stimuli.</tt><tt class="descname">FixmatStimuliFactory</tt><big>(</big><em>fm</em>, <em>loader</em><big>)</big><a class="reference internal" href="_modules/ocupy/stimuli.html#FixmatStimuliFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocupy.stimuli.FixmatStimuliFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs an categories object for all image / category 
combinations in the fixmat.</p>
<dl class="docutils">
<dt>Parameters:</dt>
<dd><dl class="first last docutils">
<dt>fm: FixMat</dt>
<dd>Used for extracting valid category/image combination.</dd>
<dt>loader: loader</dt>
<dd>Loader that accesses the stimuli for this fixmat</dd>
</dl>
</dd>
<dt>Returns:</dt>
<dd>Categories object</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ocupy.stimuli.DirectoryStimuliFactory">
<tt class="descclassname">ocupy.stimuli.</tt><tt class="descname">DirectoryStimuliFactory</tt><big>(</big><em>loader</em><big>)</big><a class="reference internal" href="_modules/ocupy/stimuli.html#DirectoryStimuliFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocupy.stimuli.DirectoryStimuliFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes an input path to the images folder of an experiment and generates
automatically the category - filenumber list needed to construct an
appropriate _categories object.</p>
<dl class="docutils">
<dt>Parameters :</dt>
<dd><dl class="first last docutils">
<dt>loader <span class="classifier-delimiter">:</span> <span class="classifier">Loader object which contains </span></dt>
<dd><dl class="first last docutils">
<dt>impath <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd>path to the input, i.e. image-, files of the experiment. All
subfolders in that path will be treated as categories. If no
subfolders are present, category 1 will be assigned and all 
files in the folder are considered input images. 
Images have to end in &#8216;.png&#8217;.</dd>
<dt>ftrpath <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first">path to the feature folder. It is expected that the folder
structure corresponds to the structure in impath, i.e.</p>
<blockquote>
<div>ftrpath/category/featurefolder/featuremap.mat</div></blockquote>
<p class="last">Furthermore, features are assumed to be the same for all 
categories.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-ocupy.stimuli"></span><p>This module implements different model evaluation measures.</p>
<span class="target" id="module-ocupy.loader"></span><p>This module abstracts access to stimuli from physical access to it.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Organization of stimuli: categories, images and features</a><ul>
<li><a class="reference internal" href="#loading-data-from-somewhere">Loading Data from somewhere</a></li>
<li><a class="reference internal" href="#working-with-the-stimulus-module">Working with the stimulus module</a></li>
<li><a class="reference internal" href="#combining-fixation-data-and-stimulus-data">Combining fixation data and stimulus data</a></li>
<li><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="fixmat.html"
                        title="previous chapter">FixMat</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="loader.html"
                        title="next chapter">Loader</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/stimuli.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="loader.html" title="Loader"
             >next</a> |</li>
        <li class="right" >
          <a href="fixmat.html" title="FixMat"
             >previous</a> |</li>
        <li><a href="index.html">res.analysis 0.01 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, WhiteMatter Labs GmbH.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>